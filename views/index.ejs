<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #2F4F4F;
        margin-top: 65px;
        align-items: center;
        text-align: center;
        background-image: url("https://source.unsplash.com/random/1920x1080");
        background-size: cover;
        background-position: center;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
        min-height: 100vh;
      }
      .container {
        max-width: 1200px; /* Increased max-width for the container */
        margin: 0 auto;
        padding: 60px; /* Increased padding for more space */
        border-radius: 15px;
        background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.2); /* Increased shadow */
        min-height: 80vh; /* Set a minimum height */
      }
      h1 {
        font-size: 3rem; /* Increased font size */
        margin-bottom: 30px; /* Increased margin */
        text-align: center;
        color: #2F4F4F;
        text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.3), 0 0 25px rgba(0, 0, 0, 0.7);
      }
      .form-control {
        border-radius: 25px;
        height: 50px;
        font-size: 1.2rem;
      }
      .btn {
        border-radius: 25px;
        padding: 10px 20px;
        font-size: 1.2rem;
      }
      .table {
        width: 100%; /* Set the table to take the full width */
      }
      .table th,
      .table td {
        vertical-align: middle;
        font-size: 1.1rem; /* Increased font size */
        padding: 15px; /* Increased padding */
      }
      .delete-btn,
      .copy-btn,
      .edit-btn {
        transition: background-color 0.3s;
        border-radius: 50px;
        padding: 10px 15px; /* Increased padding */
      }
      .delete-btn {
        background-color: #dc3545;
        color: white;
      }
      .delete-btn:hover {
        background-color: #c82333;
      }
      .copy-btn {
        /* border-left: 10px; */
        background-color: #17a2b8;
        color: white;
      }
      .copy-btn:hover {
        background-color: #138496;
      }
      .edit-btn {
        background-color: #ffc107;
        color: black;
      }
      .edit-btn:hover {
        background-color: #e0a800;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @media (max-width: 768px) {
        .form-control,
        .btn {
          width: 100%;
        }
      }
      .edit-url-container {
        display: flex; /* Use Flexbox */
        align-items: center; /* Center vertically */
        gap: 10px; /* Space between input and button */
        margin-top: 10px; /* Space above the edit URL section */
      }
    </style>
    <title>URL Shrinker</title>
</head>
<body>
    <div class="container">
      <h1 class="my-4">URL Shrinker</h1>

      <form
        action="/shortUrls"
        method="POST"
        class="d-flex align-items-center mb-4"
        style="background-color: #dc3545"
      >
        <input
          required
          placeholder="Enter URL"
          type="url"
          name="fullUrl"
          id="fullUrl"
          class="form-control me-2"
        />
        <button class="btn btn-success" type="submit">Shrink</button>
      </form>

      <table class="table table-striped table-responsive fade-in">
        <thead>
          <tr>
            <th>Full URL</th>
            <th>Short URL</th>
            <th>Clicks</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
    <% shortUrls.forEach(shortUrl => { %>
    <tr>
        <td>
            <a href="<%= shortUrl.full %>" target="_blank"><%= shortUrl.full %></a>
        </td>
        <td>
            <a href="<%= shortUrl.short %>" target="_blank"><%= shortUrl.short %></a>
            <button
                class="btn copy-btn btn-sm ms-2"
                onclick="copyToClipboard('<%= shortUrl.short %>', this)"
            >
                <i class="fas fa-copy"></i> Copy
            </button>
        </td>
        <td><%= shortUrl.clicks %></td>
        <td>
            <div class="edit-url-container">
                <button
                    class="btn delete-btn"
                    onclick="deleteUrl('<%= shortUrl.short %>')"
                >
                    <i class="fas fa-trash"></i>
                </button>
                <form
                    action="/shortUrls/<%= shortUrl.short %>/edit"
                    method="POST"
                    class="d-inline"
                >
                    <input
                        type="text"
                        name="newShortUrl"
                        placeholder="New Short URL"
                        required
                        class="form-control d-inline w-50"
                    />
                    <button class="btn edit-btn" type="submit">
                        <i class="fas fa-edit"></i>
                    </button>
                </form>
            </div>
        </td>
    </tr>
    <% }) %>
</tbody>

      </table>
    </div>

    <script>
      function copyToClipboard(shortUrl, button) {
    navigator.clipboard.writeText(shortUrl)
        .then(() => {
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i> Copied!';
            button.classList.add('btn-success');

            // Reset button state after 2 seconds
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('btn-success');
            }, 2000);
        })
        .catch(err => {
            console.error("Could not copy text: ", err);
            alert("Failed to copy the URL. Please try again.");
        });
}

      function deleteUrl(shortUrl) {
        if (confirm("Are you sure you want to delete this URL?")) {
          fetch(`/shortUrls/${shortUrl}`, {
            method: "DELETE",
          })
            .then(() => {
              location.reload(); // Reload the page to show updated URLs
            })
            .catch((error) => {
              console.error("Error deleting URL:", error);
            });
        }
      }




    </script>
</body>
</html>
